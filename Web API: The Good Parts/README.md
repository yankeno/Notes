# 2 章 エンドポイントの設計とリクエストの形式

## GET メソッド

- GET メソッドでデータの更新をできるようにしてはいけない
- Google のクローラも GET でリクエストを飛ばしてくる

## POST メソッド

- 新しいリソースの登録に使用する
- 更新、削除には使用しない

## PUT メソッド

- 既存のリソースの更新に使用する
- リクエストには更新したいリソースの URI を指定する
- リクエストしたデータでリソースを置き換える

<u>_POST と PUT の違い_</u>

```text
[POST] https://api.example.com/v1/friends
-> 配下に新しいデータを登録する

[PUT]  https://api.example.com/v1/friends/12345
-> 指定したデータそのものを更新する
```

### PATCH メソッド

- リソースの一部を更新する

## リソースにアクセスするためのエンドポイント設計の注意点

- 複数形の名詞を利用する
- エンコードが必要な文字を使わない
- 単語はハイフンつなぎにする

# 3 章 レスポンスデータの設計

## データフォーマットには何を使うか

- かつてはデータのやり取りは XML という選択肢しか無かった
- 現在では JSON に完全に置き換わった
  - 理由としてはシンプルさ、データサイズが小さい、JS との相性が良いことが挙げられる

## データの内部構造の考え方

- リクエスト回数がなるべく少なくなるように設計する
  - エンドポイントを利用するクライアントが何をしたいのかを予測して、必要な情報を返す
  - 例えば友人一覧を取得するエンドポイントの場合、クライアント側でやりたいこととしては友人一覧を画面に表示する、といったことが考えられる
  - そのためレスポンスは ID だけを返すのではなく、名前やプロフィールアイコンも併せて返すようにする(名前やプロフィール取得のために別のエンドポイントにリクエストさせるような設計にしない)
- エンベロープは使用せず、ヘッダーを使用する
- データは階層構造を持たせた方がわかりやすい場合は階層構造にし、基本的にはフラットにする

## 各データのフォーマット

- データの名前はスネークケースやキャメルケース等一般的なものならなんでもいいが API で統一する
- 日付は RFC3339 の仕様に準拠する

```text
2024-04-28T13:00:00+09:00
```

## エラーの表現

- 適切なステータスコードを使用する
- ステータスコードだけではエラーの詳細までは判別できないため、ボディにエラーの詳細情報を入れて返す
  - 最低限以下があれば OK
    - エラーの詳細コード(独自定義)
    - 詳細情報のリンク
- エラー発生時にむやみに HTML を返さない
-

# メモ

- 単語の連結はなるべく避ける
  - 繋げる場合はハイフン繋ぎ
- クエリパラメータとパスパラメータの使い分けは、リソースか否か
  - ユーザー ID などは一意なリソースを表すために必要であるためパスパラメータ
  - 検索の際の offset、limit、page はクエリパラメータ
- envelope(封筒 = データをくるむための構造)はなるべく使用せず、ヘッダーを使用する
- バージョニングのルールとして広く知られるものとして[セマンティックバージョニング](https://semver.org/lang/ja/)がある

## 参考

- [HTTP レスポンスステータスコード](https://developer.mozilla.org/ja/docs/Web/HTTP/Status)
